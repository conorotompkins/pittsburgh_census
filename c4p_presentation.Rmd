---
title: "C4P Presentation"
author: "Conor Tompkins"
date: "April 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

configure environment
```{r}
library(tidycensus)
library(tidyverse)
library(sf)
library(tigris)

theme_set(theme_bw())

options(tigris_use_cache = TRUE)

census_api_key("a16f3636406d2b544871e2ae49bb318c3ddcacba")
```

load variables
```{r}
variables_acs <- load_variables(2017, "acs5", cache = TRUE)

variables_acs

variables_dec <- load_variables(2010, "sf1", cache = TRUE)
```

load census block data for total pop
```{r}
allegheny <- get_decennial(geography = "block",
                           variables = c(total_pop = "P001001"),
                           state = "PA", county = "Allegheny County",
                           geometry = TRUE)
```

graph
```{r}
allegheny %>% 
  ggplot(aes(fill = value)) +
  geom_sf(color = NA) +
  coord_sf(crs = 26915) + 
  scale_fill_viridis_c("Total Population")
```

download demographic data for census blocks
```{r}
racevars <- c(White = "P005003", 
              Black = "P005004", 
              Asian = "P005006", 
              Hispanic = "P004003")

allegheny <- get_decennial(geography = "tract", variables = racevars, 
                        state = "PA", county = "Allegheny County", geometry = TRUE,
                        summary_var = "P001001") 
```
```{r}
allegheny <- allegheny %>% 
  mutate(pct = 100 * value / summary_value)
```

graph
```{r}
allegheny %>% 
  ggplot(aes(fill = pct)) +
  geom_sf(color = NA) +
  facet_wrap(~variable) +
  coord_sf(crs = 26915) + 
  scale_fill_viridis_c()
```

make rivers show up
```{r}
st_erase <- function(x, y) {
  st_difference(x, st_union(st_combine(y)))
}

allegheny_water <- area_water("PA", "Allegheny County", class = "sf")

allegheny_erase <- st_erase(allegheny, allegheny_water)
```
```{r}
allegheny_erase %>% 
  ggplot(aes(fill = pct)) +
  geom_sf(color = NA) +
  facet_wrap(~variable) +
  coord_sf(crs = 26915) + 
  scale_fill_viridis_c()
```

create df of census block geometry so we can join it with WPRDC data
```{r}
allegheny <- get_decennial(geography = "block",
                           variables = c(total_pop = "P001001"),
                           state = "PA", county = "Allegheny County",
                           geometry = TRUE)
```

#join with WPRDC data
```{r}

```